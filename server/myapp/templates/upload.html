<!DOCTYPE html>
<html>
<head>
    <title>Upload Image</title>
</head>
<body>
    <h1>Upload an Image</h1>
    <form action="{% url 'process_image' %}" method="post" enctype="multipart/form-data" id="upload-form">
        {% csrf_token %}
        <input type="file" name="image" required>
        <button type="submit">Upload</button>
    </form>

    <div id="result-message"></div>
    <div id="progress-message" style="display: none;">Processing...</div> <!-- Initially hidden -->

    <script>
        document.getElementById('upload-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // Clear the previous result message
            document.getElementById('result-message').textContent = '';
            document.getElementById('progress-message').textContent = '';


            var formData = new FormData(this);

            document.getElementById('progress-message').style.display = 'block';

<<<<<<< HEAD
                    fetch(event.target.action, {
                        method: event.target.method,
                        body: formData,
                        headers: {
                            'X-CSRFToken': document.getElementsByName('csrfmiddlewaretoken')[0].value
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        var resultContainer = document.createElement('div');
                        resultContainer.className = 'result-container';
                        var resultMessage = document.createElement('div');
                        resultMessage.className = 'result-message';
                        if (data.age && data.gender) {
                            resultMessage.textContent = `Age: ${data.age}, Gender: ${data.gender}`;
                        } else {
                            resultMessage.textContent = 'Error: Unable to process image.';
                        }
                        resultContainer.appendChild(resultMessage);
                        imageContainer.appendChild(resultContainer);
                        // Add id to the result message element!
                        resultMessage.id = 'age' + imageCounter;
                        if (imageCounter === 2) {
                            var winnerMessage = document.getElementById('winner-message');
                            var age1 = parseInt(document.getElementById('age1').textContent.replace('Age: ', ''));
                            var age2 = parseInt(document.getElementById('age2').textContent.replace('Age: ', ''));
                            if (age1 < age2) {
                                winnerMessage.textContent = 'The first person is younger than the second person.';
                            } else if (age1 > age2) {
                                winnerMessage.textContent = 'The second person is younger than the first person.';
                            } else {
                                winnerMessage.textContent = 'Both persons have the same age.';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        var errorMessage = document.createElement('div');
                        errorMessage.textContent = 'Error: ' + error.message;
                        var imagesContainer = document.getElementById('images-container');
                        imagesContainer.appendChild(errorMessage);
                    });
                };
                reader.readAsDataURL(imageFile);
            }
=======
            // Start updating progress message immediately after making the request
            var progressMessageDiv = document.getElementById('progress-message');
            var progressCounter = 0;
            var progressInterval = setInterval(function() {
                progressCounter += 10; // Update the progress by 10% every interval
                progressMessageDiv.textContent = 'Processing... ' + progressCounter + '%';
                if (progressCounter >= 95) {
                    progressMessageDiv.textContent = 'Processing... ' + '95%';
                    clearInterval(progressInterval); // Stop updating when progress reaches 100%
                }
            }, 1000); // Update every second (adjust as needed)

            fetch(this.action, {
                method: this.method,
                body: formData,
                headers: {
                    'X-CSRFToken': document.getElementsByName('csrfmiddlewaretoken')[0].value
                }
            })
            .then(response => response.json())
            .then(data => {
                // Display the result once processing is complete
                document.getElementById('progress-message').textContent = '';
                if (data.age && data.gender) {
                    document.getElementById('result-message').innerHTML = `Age: ${data.age}, Gender: ${data.gender}`;
                } else {
                    document.getElementById('result-message').textContent = 'Error: Unable to process image.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result-message').textContent = 'Error: ' + error.message;
            });
>>>>>>> origin
        });

    </script>
</body>
</html>
