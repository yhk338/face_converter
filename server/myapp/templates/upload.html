<!DOCTYPE html>
<html>
<head>
    <title>Upload Image</title>
</head>
<body>
    <h1>Upload an Image</h1>
    <form action="{% url 'process_image' %}" method="post" enctype="multipart/form-data" id="upload-form">
        {% csrf_token %}
        <input type="file" name="image" required>
        <button type="submit">Upload</button>
    </form>

    <div id="result-message"></div>
    <div id="progress-message" style="display: none;">Processing...</div> <!-- Initially hidden -->

    <script>
        document.getElementById('upload-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // Clear the previous result message
            document.getElementById('result-message').textContent = '';
            document.getElementById('progress-message').textContent = '';


            var formData = new FormData(this);

            document.getElementById('progress-message').style.display = 'block';

            // Start updating progress message immediately after making the request
            var progressMessageDiv = document.getElementById('progress-message');
            var progressCounter = 0;
            var progressInterval = setInterval(function() {
                progressCounter += 10; // Update the progress by 10% every interval
                progressMessageDiv.textContent = 'Processing... ' + progressCounter + '%';
                if (progressCounter >= 95) {
                    progressMessageDiv.textContent = 'Processing... ' + '95%';
                    clearInterval(progressInterval); // Stop updating when progress reaches 100%
                }
            }, 1000); // Update every second (adjust as needed)

            fetch(this.action, {
                method: this.method,
                body: formData,
                headers: {
                    'X-CSRFToken': document.getElementsByName('csrfmiddlewaretoken')[0].value
                }
            })
            .then(response => response.json())
            .then(data => {
                // Display the result once processing is complete
                document.getElementById('progress-message').textContent = '';
                if (data.age && data.gender) {
                    document.getElementById('result-message').innerHTML = `Age: ${data.age}, Gender: ${data.gender}`;
                } else {
                    document.getElementById('result-message').textContent = 'Error: Unable to process image.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('result-message').textContent = 'Error: ' + error.message;
            });
        });

    </script>
</body>
</html>
